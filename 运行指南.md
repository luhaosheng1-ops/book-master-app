# 📘 读书解构大师 - 运行指南

## 🎯 项目简介

这是一个基于 **DeepSeek API** 的电子书深度解构工具，可以将书籍内容智能解构为结构化的知识手册，支持**逐段飞入动画**展示，让您实时看到AI解构的过程。

## 📋 运行前准备

### 1. 获取 DeepSeek API Key

1. 访问 [DeepSeek 官网](https://www.deepseek.com/)
2. 注册/登录账号
3. 进入 API 管理页面，创建 API Key
4. 复制你的 API Key（格式类似：`sk-xxxxxxxxxxxxx`）

### 2. 创建环境配置文件

在项目根目录创建 `.env` 文件（如果还没有的话）：

```env
# DeepSeek API 密钥（必填）
DEEPSEEK_API_KEY=sk-你的API密钥

# 输出目录（可选，默认是 ./output）
OUTPUT_DIRECTORY=./output
```

## 🚀 运行方式

### 方式一：使用 Docker Compose（推荐）

**优点**：环境隔离，一键启动，适合生产环境

#### 步骤：

1. **确保已安装 Docker 和 Docker Compose**
   - Windows: 安装 [Docker Desktop](https://www.docker.com/products/docker-desktop/)
   - 检查安装：在命令行运行 `docker --version` 和 `docker-compose --version`

2. **在项目根目录创建 `.env` 文件**
   ```env
   DEEPSEEK_API_KEY=sk-你的API密钥
   OUTPUT_DIRECTORY=./output
   ```

3. **启动服务**
   ```bash
   # 进入项目目录
   cd D:\project\book-master
   
   # 启动服务（首次运行会自动构建）
   docker-compose up -d --build
   ```

4. **查看运行状态**
   ```bash
   # 查看容器状态
   docker-compose ps
   
   # 查看日志
   docker-compose logs -f
   ```

5. **访问应用**
   - 打开浏览器访问：`http://localhost:8000`
   - 前端界面会自动加载

6. **停止服务**
   ```bash
   docker-compose down
   ```

---

### 方式二：本地运行（开发调试）

**优点**：修改代码后立即生效，方便调试

#### 后端运行步骤：

1. **安装 Python 3.9+**
   - 检查版本：`python --version`

2. **安装依赖**
   ```bash
   cd backend
   pip install -r requirements.txt
   ```
   
   如果安装慢，可以使用国内镜像：
   ```bash
   pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt
   ```

3. **配置环境变量**
   
   在项目根目录创建 `.env` 文件：
   ```env
   DEEPSEEK_API_KEY=sk-你的API密钥
   OUTPUT_DIRECTORY=./output
   ```

4. **启动后端服务**
   ```bash
   cd backend
   uvicorn main:app --host 0.0.0.0 --port 8000 --reload
   ```
   
   看到类似输出说明启动成功：
   ```
   INFO:     Uvicorn running on http://0.0.0.0:8000
   ```

#### 前端运行步骤：

1. **直接用浏览器打开**
   
   最简单的方式：直接用浏览器打开 `frontend/index.html` 文件
   
   - 双击 `frontend/index.html`
   - 或者在浏览器地址栏输入：`file:///D:/project/book-master/frontend/index.html`

2. **或者使用本地服务器（推荐）**
   
   **方法A：使用 Python 简单服务器**
   ```bash
   cd frontend
   python -m http.server 3000
   ```
   然后访问：`http://localhost:3000`
   
   **方法B：使用 Node.js**
   ```bash
   cd frontend
   npx http-server -p 3000
   ```

---

## 📖 使用教程

### 1. 上传书籍

1. 打开浏览器访问 `http://localhost:8000`
2. 点击上传区域或拖拽文件
3. 支持格式：`.pdf`, `.txt`, `.epub`, `.mobi`, `.azw3`

### 2. 观看AI解构过程

- 上传后，会显示"AI正在逐段生成内容..."
- **内容会一段一段飞入显示**，每段都有流畅的动画效果
- 可以实时看到AI解构的过程，非常有趣！

### 3. 查看结果

- 解构完成后，内容会完整显示
- 点击"📥 下载 MD"按钮可以下载Markdown文件
- 点击"🖨️ 打印 PDF"可以打印或保存为PDF

### 4. 清除缓存

- 点击"🧹 清除"按钮可以清除本地缓存
- 下次打开页面时会自动恢复上次的解构结果

---

## 🔧 常见问题

### Q1: 启动失败，提示找不到模块？

**A**: 确保已安装所有依赖：
```bash
cd backend
pip install -r requirements.txt
```

### Q2: API调用失败？

**A**: 检查以下几点：
1. `.env` 文件中的 `DEEPSEEK_API_KEY` 是否正确
2. API Key 是否有效（账户余额是否充足）
3. 网络是否能访问 `https://api.deepseek.com`

### Q3: Docker 容器启动失败？

**A**: 
1. 检查 Docker 是否正常运行：`docker ps`
2. 查看错误日志：`docker-compose logs`
3. 确保 `.env` 文件在项目根目录

### Q4: 前端无法连接后端？

**A**: 
1. 确保后端服务已启动（访问 `http://localhost:8000` 应该能看到页面）
2. 检查浏览器控制台是否有错误（按 F12 打开开发者工具）
3. 如果使用 `file://` 协议打开，需要改用本地服务器（见方式二）

### Q5: 内容没有逐段飞入？

**A**: 
1. 确保使用的是最新代码（已实现流式传输）
2. 检查浏览器控制台是否有错误
3. 尝试刷新页面重新上传

---

## 📁 项目结构

```
book-master/
├── backend/              # 后端代码
│   ├── main.py          # FastAPI 主程序
│   ├── requirements.txt # Python 依赖
│   └── output/          # 生成的Markdown文件存储目录
├── frontend/            # 前端代码
│   └── index.html       # 前端页面（包含流式接收和动画）
├── docker-compose.yml   # Docker 配置
├── .env                 # 环境变量配置（需要自己创建）
└── README.md            # 项目说明
```

---

## 🎨 新功能：逐段飞入动画

现在AI解构的内容会**一段一段飞入显示**，让您：
- ✨ 实时看到AI思考的过程
- 🎬 享受流畅的动画效果
- 📊 更直观地理解内容结构

每段内容都有独立的飞入动画，从下方左侧优雅地滑入，非常有趣！

---

## 💡 提示

1. **首次运行**：建议先用小文件测试（如几页的PDF）
2. **API费用**：DeepSeek API 按使用量计费，注意控制成本
3. **文件大小**：建议上传的文件不要太大（< 10MB），处理会更快
4. **网络要求**：需要稳定的网络连接，因为需要调用API

---

## 🆘 需要帮助？

如果遇到问题：
1. 查看本文档的"常见问题"部分
2. 检查浏览器控制台的错误信息（F12）
3. 查看后端日志输出

祝您使用愉快！📚✨
